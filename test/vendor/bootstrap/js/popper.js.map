{"version":3,"sources":["webpack:///webpack/bootstrap 6c1d2c9d59b9d31b85ce","webpack:///./subscriptionLink.postload.js","webpack:///./composer.postload.js"],"names":[],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,KAAK;QACL;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;QAEA;QACA;;;;;;;;;;;;;;;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;;AAEa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;;;;;;;;ACtGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;;AAEa;;AAEb;AACA;AACA;AACA,OAAO,6DAA6D;;AAEpE;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,uBAAuB,GAAG;AAC1B;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oCAAoC,iCAAiC;AACrE,wCAAwC,uBAAuB;AAC/D;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB;AACpB,SAAS;AACT;AACA,KAAK;;AAEL;AACA;;AAEA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,kCAAkC,eAAe;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA,GAAG;;AAEH;AACA,iCAAiC,uBAAuB;;AAExD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"include.postload.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 6c1d2c9d59b9d31b85ce","/*\r\n * This file is part of Adblock Plus <https://adblockplus.org/>,\r\n * Copyright (C) 2006-present eyeo GmbH\r\n *\r\n * Adblock Plus is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU General Public License version 3 as\r\n * published by the Free Software Foundation.\r\n *\r\n * Adblock Plus is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with Adblock Plus.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n\"use strict\";\r\n\r\nif (document instanceof HTMLDocument)\r\n{\r\n  document.addEventListener(\"click\", event =>\r\n  {\r\n    // Ignore right-clicks\r\n    if (event.button == 2)\r\n      return;\r\n\r\n    // Ignore simulated clicks.\r\n    if (event.isTrusted == false)\r\n      return;\r\n\r\n    // Search the link associated with the click\r\n    let link = event.target;\r\n    while (!(link instanceof HTMLAnchorElement))\r\n    {\r\n      link = link.parentNode;\r\n\r\n      if (!link)\r\n        return;\r\n    }\r\n\r\n    let queryString = null;\r\n    if (link.protocol == \"http:\" || link.protocol == \"https:\")\r\n    {\r\n      if (link.host == \"subscribe.adblockplus.org\" && link.pathname == \"/\")\r\n        queryString = link.search.substr(1);\r\n    }\r\n    else\r\n    {\r\n      // Firefox 51 doesn't seem to populate the \"search\" property for\r\n      // links with non-standard URL schemes so we need to extract the query\r\n      // string manually.\r\n      let match = /^abp:\\/*subscribe\\/*\\?(.*)/i.exec(link.href);\r\n      if (match)\r\n        queryString = match[1];\r\n    }\r\n\r\n    if (!queryString)\r\n      return;\r\n\r\n    // This is our link - make sure the browser doesn't handle it\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n\r\n    // Decode URL parameters\r\n    let title = null;\r\n    let url = null;\r\n    for (let param of queryString.split(\"&\"))\r\n    {\r\n      let parts = param.split(\"=\", 2);\r\n      if (parts.length != 2 || !/\\S/.test(parts[1]))\r\n        continue;\r\n      switch (parts[0])\r\n      {\r\n        case \"title\":\r\n          title = decodeURIComponent(parts[1]);\r\n          break;\r\n        case \"location\":\r\n          url = decodeURIComponent(parts[1]);\r\n          break;\r\n      }\r\n    }\r\n    if (!url)\r\n      return;\r\n\r\n    // Default title to the URL\r\n    if (!title)\r\n      title = url;\r\n\r\n    // Trim spaces in title and URL\r\n    title = title.trim();\r\n    url = url.trim();\r\n    if (!/^(https?|ftp):/.test(url))\r\n      return;\r\n\r\n    browser.runtime.sendMessage({\r\n      type: \"subscriptions.add\",\r\n      title,\r\n      url,\r\n      confirm: true\r\n    });\r\n  }, true);\r\n}\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./subscriptionLink.postload.js\n// module id = 1\n// module chunks = 0","/*\r\n * This file is part of Adblock Plus <https://adblockplus.org/>,\r\n * Copyright (C) 2006-present eyeo GmbH\r\n *\r\n * Adblock Plus is free software: you can redistribute it and/or modify\r\n * it under the terms of the GNU General Public License version 3 as\r\n * published by the Free Software Foundation.\r\n *\r\n * Adblock Plus is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with Adblock Plus.  If not, see <http://www.gnu.org/licenses/>.\r\n */\r\n\r\n\"use strict\";\r\n\r\n// We would rather export these properly and then require(\"./include.preload\")\r\n// here, but that would result in include.preload running both at pre and post\r\n// load.\r\nconst {checkCollapse, contentFiltering, getURLsFromElement, typeMap} = window;\r\n\r\n// The page ID for the popup filter selection dialog (top frame only).\r\nlet blockelementPopupId = null;\r\n\r\n// Element picking state (top frame only).\r\nlet currentlyPickingElement = false;\r\nlet lastMouseOverEvent = null;\r\n\r\n// During element picking this is the currently highlighted element. When\r\n// element has been picked this is the element that is due to be blocked.\r\nlet currentElement = null;\r\n\r\n// Highlighting state, used by the top frame during element picking and all\r\n// frames when the chosen element is highlighted red.\r\nlet highlightedElementsSelector = null;\r\nlet highlightedElementsInterval = null;\r\n\r\n// Last right click state stored for element blocking via the context menu.\r\nlet lastRightClickEvent = null;\r\nlet lastRightClickEventIsMostRecent = false;\r\n\r\n\r\n/* Utilities */\r\n\r\nfunction getFiltersForElement(element, callback)\r\n{\r\n  let src = element.getAttribute(\"src\");\r\n  browser.runtime.sendMessage({\r\n    type: \"composer.getFilters\",\r\n    tagName: element.localName,\r\n    id: element.id,\r\n    src: src && src.length <= 1000 ? src : null,\r\n    style: element.getAttribute(\"style\"),\r\n    classes: Array.prototype.slice.call(element.classList),\r\n    urls: getURLsFromElement(element),\r\n    mediatype: typeMap.get(element.localName),\r\n    baseURL: document.location.href\r\n  }).then(response =>\r\n  {\r\n    callback(response.filters, response.selectors);\r\n  });\r\n}\r\n\r\nfunction getBlockableElementOrAncestor(element, callback)\r\n{\r\n  // We assume that the user doesn't want to block the whole page.\r\n  // So we never consider the <html> or <body> element.\r\n  while (element && element != document.documentElement &&\r\n         element != document.body)\r\n  {\r\n    // We can't handle non-HTML (like SVG) elements, as well as\r\n    // <area> elements (see below). So fall back to the parent element.\r\n    if (!(element instanceof HTMLElement) || element.localName == \"area\")\r\n      element = element.parentElement;\r\n\r\n    // If image maps are used mouse events occur for the <area> element.\r\n    // But we have to block the image associated with the <map> element.\r\n    else if (element.localName == \"map\")\r\n    {\r\n      let images = document.querySelectorAll(\"img[usemap]\");\r\n      let image = null;\r\n\r\n      for (let currentImage of images)\r\n      {\r\n        let usemap = currentImage.getAttribute(\"usemap\");\r\n        let index = usemap.indexOf(\"#\");\r\n\r\n        if (index != -1 && usemap.substr(index + 1) == element.name)\r\n        {\r\n          image = currentImage;\r\n          break;\r\n        }\r\n      }\r\n\r\n      element = image;\r\n    }\r\n\r\n    // Finally, if none of the above is true, check whether we can generate\r\n    // any filters for this element. Otherwise fall back to its parent element.\r\n    else\r\n    {\r\n      getFiltersForElement(element, filters =>\r\n      {\r\n        if (filters.length > 0)\r\n          callback(element);\r\n        else\r\n          getBlockableElementOrAncestor(element.parentElement, callback);\r\n      });\r\n\r\n      return;\r\n    }\r\n  }\r\n\r\n  // We reached the document root without finding a blockable element.\r\n  callback(null);\r\n}\r\n\r\n\r\n/* Element highlighting */\r\n\r\n// Adds an overlay to an element in order to highlight it.\r\nfunction addElementOverlay(element)\r\n{\r\n  let position = \"absolute\";\r\n  let offsetX = window.scrollX;\r\n  let offsetY = window.scrollY;\r\n\r\n  for (let e = element; e; e = e.parentElement)\r\n  {\r\n    let style = getComputedStyle(e);\r\n\r\n    // If the element isn't rendered (since its or one of its ancestor's\r\n    // \"display\" property is \"none\"), the overlay wouldn't match the element.\r\n    if (style.display == \"none\")\r\n      return null;\r\n\r\n    // If the element or one of its ancestors uses fixed postioning, the overlay\r\n    // must too. Otherwise its position might not match the element's.\r\n    if (style.position == \"fixed\")\r\n    {\r\n      position = \"fixed\";\r\n      offsetX = offsetY = 0;\r\n    }\r\n  }\r\n\r\n  let overlay = document.createElement(\"div\");\r\n  overlay.prisoner = element;\r\n  overlay.className = \"__adblockplus__overlay\";\r\n  overlay.setAttribute(\"style\",\r\n                       \"opacity:0.4; display:inline-block !important; \" +\r\n                       \"overflow:hidden; box-sizing:border-box;\");\r\n  let rect = element.getBoundingClientRect();\r\n  overlay.style.width = rect.width + \"px\";\r\n  overlay.style.height = rect.height + \"px\";\r\n  overlay.style.left = (rect.left + offsetX) + \"px\";\r\n  overlay.style.top = (rect.top + offsetY) + \"px\";\r\n  overlay.style.position = position;\r\n  overlay.style.zIndex = 0x7FFFFFFE;\r\n\r\n  document.documentElement.appendChild(overlay);\r\n  return overlay;\r\n}\r\n\r\nfunction highlightElement(element, shadowColor, backgroundColor)\r\n{\r\n  unhighlightElement(element);\r\n\r\n  let highlightWithOverlay = () =>\r\n  {\r\n    let overlay = addElementOverlay(element);\r\n\r\n    // If the element isn't displayed no overlay will be added.\r\n    // Moreover, we don't need to highlight anything then.\r\n    if (!overlay)\r\n      return;\r\n\r\n    highlightElement(overlay, shadowColor, backgroundColor);\r\n    overlay.style.pointerEvents = \"none\";\r\n\r\n    element._unhighlight = () =>\r\n    {\r\n      overlay.parentNode.removeChild(overlay);\r\n    };\r\n  };\r\n\r\n  let highlightWithStyleAttribute = () =>\r\n  {\r\n    let originalBoxShadow = element.style.getPropertyValue(\"box-shadow\");\r\n    let originalBoxShadowPriority =\r\n      element.style.getPropertyPriority(\"box-shadow\");\r\n    let originalBackgroundColor =\r\n      element.style.getPropertyValue(\"background-color\");\r\n    let originalBackgroundColorPriority =\r\n      element.style.getPropertyPriority(\"background-color\");\r\n\r\n    element.style.setProperty(\"box-shadow\", \"inset 0px 0px 5px \" + shadowColor,\r\n                              \"important\");\r\n    element.style.setProperty(\"background-color\", backgroundColor, \"important\");\r\n\r\n    element._unhighlight = () =>\r\n    {\r\n      element.style.removeProperty(\"box-shadow\");\r\n      element.style.setProperty(\r\n        \"box-shadow\",\r\n        originalBoxShadow,\r\n        originalBoxShadowPriority\r\n      );\r\n\r\n      element.style.removeProperty(\"background-color\");\r\n      element.style.setProperty(\r\n        \"background-color\",\r\n        originalBackgroundColor,\r\n        originalBackgroundColorPriority\r\n      );\r\n    };\r\n  };\r\n\r\n  // If this element is an overlay that we've created previously then we need\r\n  // to give it a background colour. Otherwise we need to create an overlay\r\n  // and then recurse in order to set the overlay's background colour.\r\n  if (\"prisoner\" in element)\r\n    highlightWithStyleAttribute();\r\n  else\r\n    highlightWithOverlay();\r\n}\r\n\r\nfunction unhighlightElement(element)\r\n{\r\n  if (element && \"_unhighlight\" in element)\r\n  {\r\n    element._unhighlight();\r\n    delete element._unhighlight;\r\n  }\r\n}\r\n\r\n// Highlight elements matching the selector string red.\r\n// (All elements that would be blocked by the proposed filters.)\r\nfunction highlightElements(selectorString)\r\n{\r\n  unhighlightElements();\r\n\r\n  let elements = Array.prototype.slice.call(\r\n    document.querySelectorAll(selectorString)\r\n  );\r\n  highlightedElementsSelector = selectorString;\r\n\r\n  // Highlight elements progressively. Otherwise the page freezes\r\n  // when a lot of elements get highlighted at the same time.\r\n  highlightedElementsInterval = setInterval(() =>\r\n  {\r\n    if (elements.length > 0)\r\n    {\r\n      let element = elements.shift();\r\n      if (element != currentElement)\r\n        highlightElement(element, \"#fd6738\", \"#f6e1e5\");\r\n    }\r\n    else\r\n    {\r\n      clearInterval(highlightedElementsInterval);\r\n      highlightedElementsInterval = null;\r\n    }\r\n  }, 0);\r\n}\r\n\r\n// Unhighlight the elements that were highlighted by selector string previously.\r\nfunction unhighlightElements()\r\n{\r\n  if (highlightedElementsInterval)\r\n  {\r\n    clearInterval(highlightedElementsInterval);\r\n    highlightedElementsInterval = null;\r\n  }\r\n\r\n  if (highlightedElementsSelector)\r\n  {\r\n    Array.prototype.forEach.call(\r\n      document.querySelectorAll(highlightedElementsSelector),\r\n      unhighlightElement\r\n    );\r\n\r\n    highlightedElementsSelector = null;\r\n  }\r\n}\r\n\r\n\r\n/* Input event handlers */\r\n\r\nfunction stopEventPropagation(event)\r\n{\r\n  event.stopPropagation();\r\n}\r\n\r\n// Hovering over an element so highlight it.\r\nfunction mouseOver(event)\r\n{\r\n  lastMouseOverEvent = event;\r\n\r\n  getBlockableElementOrAncestor(event.target, element =>\r\n  {\r\n    if (event == lastMouseOverEvent)\r\n    {\r\n      lastMouseOverEvent = null;\r\n\r\n      if (currentlyPickingElement)\r\n      {\r\n        if (currentElement)\r\n          unhighlightElement(currentElement);\r\n\r\n        if (element)\r\n          highlightElement(element, \"#d6d84b\", \"#f8fa47\");\r\n\r\n        currentElement = element;\r\n      }\r\n    }\r\n  });\r\n\r\n  event.stopPropagation();\r\n}\r\n\r\n// No longer hovering over this element so unhighlight it.\r\nfunction mouseOut(event)\r\n{\r\n  if (!currentlyPickingElement || currentElement != event.target)\r\n    return;\r\n\r\n  unhighlightElement(currentElement);\r\n  event.stopPropagation();\r\n}\r\n\r\n// Key events - Return selects currently hovered-over element, escape aborts.\r\nfunction keyDown(event)\r\n{\r\n  if (!event.ctrlKey && !event.altKey && !event.shiftKey)\r\n  {\r\n    if (event.keyCode == 13) // Return\r\n      elementPicked(event);\r\n    else if (event.keyCode == 27) // Escape\r\n      deactivateBlockElement();\r\n  }\r\n}\r\n\r\n\r\n/* Element selection */\r\n\r\n// Start highlighting elements yellow as the mouse moves over them, when one is\r\n// chosen launch the popup dialog for the user to confirm the generated filters.\r\nfunction startPickingElement()\r\n{\r\n  currentlyPickingElement = true;\r\n\r\n  // Add (currently invisible) overlays for blockable elements that don't emit\r\n  // mouse events, so that they can still be selected.\r\n  Array.prototype.forEach.call(\r\n    document.querySelectorAll(\"object,embed,iframe,frame\"),\r\n    element =>\r\n    {\r\n      getFiltersForElement(element, filters =>\r\n      {\r\n        if (filters.length > 0)\r\n          addElementOverlay(element);\r\n      });\r\n    }\r\n  );\r\n\r\n  document.addEventListener(\"mousedown\", stopEventPropagation, true);\r\n  document.addEventListener(\"mouseup\", stopEventPropagation, true);\r\n  document.addEventListener(\"mouseenter\", stopEventPropagation, true);\r\n  document.addEventListener(\"mouseleave\", stopEventPropagation, true);\r\n  document.addEventListener(\"mouseover\", mouseOver, true);\r\n  document.addEventListener(\"mouseout\", mouseOut, true);\r\n  document.addEventListener(\"click\", elementPicked, true);\r\n  document.addEventListener(\"contextmenu\", elementPicked, true);\r\n  document.addEventListener(\"keydown\", keyDown, true);\r\n\r\n  ext.onExtensionUnloaded.addListener(deactivateBlockElement);\r\n}\r\n\r\n// The user has picked an element - currentElement. Highlight it red, generate\r\n// filters for it and open a popup dialog so that the user can confirm.\r\nfunction elementPicked(event)\r\n{\r\n  if (!currentElement)\r\n    return;\r\n\r\n  let element = currentElement.prisoner || currentElement;\r\n  getFiltersForElement(element, (filters, selectors) =>\r\n  {\r\n    if (currentlyPickingElement)\r\n      stopPickingElement();\r\n\r\n    browser.runtime.sendMessage({\r\n      type: \"composer.openDialog\",\r\n      filters\r\n    }).then(popupId =>\r\n    {\r\n      // Only the top frame keeps a record of the popup window's ID,\r\n      // so if this isn't the top frame we need to pass the ID on.\r\n      if (window == window.top)\r\n      {\r\n        blockelementPopupId = popupId;\r\n      }\r\n      else\r\n      {\r\n        browser.runtime.sendMessage({\r\n          type: \"composer.forward\",\r\n          payload: {type: \"composer.content.dialogOpened\", popupId}\r\n        });\r\n      }\r\n    });\r\n\r\n    if (selectors.length > 0)\r\n      highlightElements(selectors.join(\",\"));\r\n\r\n    highlightElement(currentElement, \"#fd1708\", \"#f6a1b5\");\r\n  });\r\n\r\n  event.preventDefault();\r\n  event.stopPropagation();\r\n}\r\n\r\nfunction stopPickingElement()\r\n{\r\n  currentlyPickingElement = false;\r\n\r\n  document.removeEventListener(\"mousedown\", stopEventPropagation, true);\r\n  document.removeEventListener(\"mouseup\", stopEventPropagation, true);\r\n  document.removeEventListener(\"mouseenter\", stopEventPropagation, true);\r\n  document.removeEventListener(\"mouseleave\", stopEventPropagation, true);\r\n  document.removeEventListener(\"mouseover\", mouseOver, true);\r\n  document.removeEventListener(\"mouseout\", mouseOut, true);\r\n  document.removeEventListener(\"click\", elementPicked, true);\r\n  document.removeEventListener(\"contextmenu\", elementPicked, true);\r\n  document.removeEventListener(\"keydown\", keyDown, true);\r\n}\r\n\r\n\r\n/* Core logic */\r\n\r\n// We're done with the block element feature for now, tidy everything up.\r\nfunction deactivateBlockElement(popupAlreadyClosed)\r\n{\r\n  if (currentlyPickingElement)\r\n    stopPickingElement();\r\n\r\n  if (blockelementPopupId != null && !popupAlreadyClosed)\r\n  {\r\n    browser.runtime.sendMessage({\r\n      type: \"composer.forward\",\r\n      targetPageId: blockelementPopupId,\r\n      payload:\r\n      {\r\n        type: \"composer.dialog.close\"\r\n      }\r\n    });\r\n  }\r\n\r\n  blockelementPopupId = null;\r\n  lastRightClickEvent = null;\r\n\r\n  if (currentElement)\r\n  {\r\n    unhighlightElement(currentElement);\r\n    currentElement = null;\r\n  }\r\n  unhighlightElements();\r\n\r\n  let overlays = document.getElementsByClassName(\"__adblockplus__overlay\");\r\n  while (overlays.length > 0)\r\n    overlays[0].parentNode.removeChild(overlays[0]);\r\n\r\n  ext.onExtensionUnloaded.removeListener(deactivateBlockElement);\r\n}\r\n\r\nfunction initializeComposer()\r\n{\r\n  if (typeof ext == \"undefined\")\r\n    return false;\r\n\r\n  // Use a contextmenu handler to save the last element the user right-clicked\r\n  // on. To make things easier, we actually save the DOM event. We have to do\r\n  // this because the contextMenu API only provides a URL, not the actual DOM\r\n  // element.\r\n  //   We also need to make sure that the previous right click event,\r\n  // if there is one, is removed. We don't know which frame it is in so we must\r\n  // send a message to the other frames to clear their old right click events.\r\n  document.addEventListener(\"contextmenu\", event =>\r\n  {\r\n    lastRightClickEvent = event;\r\n    lastRightClickEventIsMostRecent = true;\r\n\r\n    browser.runtime.sendMessage({\r\n      type: \"composer.forward\",\r\n      payload:\r\n      {\r\n        type: \"composer.content.clearPreviousRightClickEvent\"\r\n      }\r\n    });\r\n  }, true);\r\n\r\n  ext.onMessage.addListener((message, sender, sendResponse) =>\r\n  {\r\n    switch (message.type)\r\n    {\r\n      case \"composer.content.getState\":\r\n        if (window == window.top)\r\n        {\r\n          sendResponse({\r\n            active: currentlyPickingElement || blockelementPopupId != null\r\n          });\r\n        }\r\n        break;\r\n      case \"composer.content.startPickingElement\":\r\n        if (window == window.top)\r\n          startPickingElement();\r\n        break;\r\n      case \"composer.content.contextMenuClicked\":\r\n        let event = lastRightClickEvent;\r\n        deactivateBlockElement();\r\n        if (event)\r\n        {\r\n          getBlockableElementOrAncestor(event.target, element =>\r\n          {\r\n            if (element)\r\n            {\r\n              currentElement = element;\r\n              elementPicked(event);\r\n            }\r\n          });\r\n        }\r\n        break;\r\n      case \"composer.content.finished\":\r\n        if (currentElement && message.remove)\r\n        {\r\n          // Hide the selected element itself if an added blocking\r\n          // filter is causing it to collapse. Note that this\r\n          // behavior is incomplete, but the best we can do here,\r\n          // e.g. if an added blocking filter matches other elements,\r\n          // the effect won't be visible until the page is is reloaded.\r\n          checkCollapse(currentElement.prisoner || currentElement);\r\n\r\n          // Apply added element hiding filters.\r\n          contentFiltering.apply({elemhide: true});\r\n        }\r\n        deactivateBlockElement(!!message.popupAlreadyClosed);\r\n        break;\r\n      case \"composer.content.clearPreviousRightClickEvent\":\r\n        if (!lastRightClickEventIsMostRecent)\r\n          lastRightClickEvent = null;\r\n        lastRightClickEventIsMostRecent = false;\r\n        break;\r\n      case \"composer.content.dialogOpened\":\r\n        if (window == window.top)\r\n          blockelementPopupId = message.popupId;\r\n        break;\r\n      case \"composer.content.dialogClosed\":\r\n        // The onRemoved hook for the popup can create a race condition, so we\r\n        // to be careful here. (This is not perfect, but best we can do.)\r\n        if (window == window.top && blockelementPopupId == message.popupId)\r\n        {\r\n          browser.runtime.sendMessage({\r\n            type: \"composer.forward\",\r\n            payload:\r\n            {\r\n              type: \"composer.content.finished\",\r\n              popupAlreadyClosed: true\r\n            }\r\n          });\r\n        }\r\n        break;\r\n    }\r\n  });\r\n\r\n  if (window == window.top)\r\n    browser.runtime.sendMessage({type: \"composer.ready\"});\r\n\r\n  return true;\r\n}\r\n\r\nif (document instanceof HTMLDocument)\r\n{\r\n  // There's a bug in Firefox that causes document_end content scripts to run\r\n  // before document_start content scripts on extension startup. In this case\r\n  // the ext object is undefined, we fail to initialize, and initializeComposer\r\n  // returns false. As a workaround, try again after a timeout.\r\n  // https://bugzilla.mozilla.org/show_bug.cgi?id=1395287\r\n  if (!initializeComposer())\r\n    setTimeout(initializeComposer, 2000);\r\n}\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./composer.postload.js\n// module id = 2\n// module chunks = 0"],"sourceRoot":""}